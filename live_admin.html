<!DOCTYPE html>
<html>
<head>
<title>Painel de Live â€“ ADMIN</title>
<style>
body { background:#000; color:#fff; font-family:Arial; text-align:center; }
video { width:90%; margin-top:20px; border-radius:12px; }
button { padding:12px 20px; margin:15px; font-size:18px; border:none; border-radius:8px; cursor:pointer; }
.on { background:#28a745; }
.off { background:#dc3545; }
</style>
</head>
<body>

<h1>ðŸ”´ PAINEL ADMIN â€“ TRANSMITIR LIVE</h1>

<video id="adminVideo" autoplay playsinline></video>
<br>

<button class="on" onclick="startLive()">Iniciar Live</button>
<button class="off" onclick="stopLive()">Encerrar Live</button>

<script type="module">

/* ============================
   IMPORTS FIREBASE
============================ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ============================
   CONFIG FIREBASE
============================ */
const firebaseConfig = {
  apiKey: "AIzaSyBod8YVf5pKWI98m9rRR8axokDkNMlXX-k",
  authDomain: "aviatordaniel100x.firebaseapp.com",
  databaseURL: "https://aviatordaniel100x-default-rtdb.firebaseio.com",
  projectId: "aviatordaniel100x",
  storageBucket: "aviatordaniel100x.firebasestorage.app",
  messagingSenderId: "169015417803",
  appId: "1:169015417803:web:ce4aa4f9b77d5ddb07344e",
  measurementId: "G-EES9SVSV72"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ============================
   VARIÃVEIS GLOBAIS
============================ */
let pc;
let localStream;

/* ============================
   FUNÃ‡ÃƒO START LIVE (corrigida)
============================ */
async function startLive() {
    localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    document.getElementById("adminVideo").srcObject = localStream;

    pc = new RTCPeerConnection();

    localStream.getTracks().forEach(t => pc.addTrack(t, localStream));

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    await setDoc(doc(db, "live", "stream"), {
        active: true,
        offer: offer
    });

    alert("ðŸŽ¥ Live iniciada!");
}

/* ============================
   FUNÃ‡ÃƒO STOP LIVE
============================ */
async function stopLive() {
    await updateDoc(doc(db, "live", "stream"), { active: false });

    if (localStream) localStream.getTracks().forEach(t => t.stop());

    alert("ðŸ”´ Live encerrada.");
}

/* ============================
   DEIXAR FUNÃ‡Ã•ES GLOBAIS
============================ */
window.startLive = startLive;
window.stopLive = stopLive;

</script>

</body>
</html>
