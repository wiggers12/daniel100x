<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HistÃ³rico 7XX</title>

<style>
    body {
        background: #0c0c12;
        color: #fff;
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        margin-bottom: 10px;
        color: #ff4da6;
    }

    /* Ãšltimo sinal */
    .ultimo-sinal {
        background: #1a1a27;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
        box-shadow: 0 0 10px #000;
    }
    .ultimo-sinal span {
        display: block;
        margin-top: 5px;
        font-size: 1.2rem;
        font-weight: bold;
    }

    /* Filtros */
    .filtros {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
    }
    .filtros button {
        padding: 8px 16px;
        background: #1f1f2b;
        border: 1px solid #444;
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        transition: 0.2s;
    }
    .filtros button:hover {
        background: #ff4da6;
    }
    .filtros .ativo {
        background: #ff4da6;
        border-color: #ff4da6;
    }

    /* HistÃ³rico */
    #listaHistorico {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
    }

    .hist-item {
        padding: 15px 5px;
        border-radius: 10px;
        text-align: center;
        font-weight: bold;
        font-size: 1.1rem;
        color: #fff;
        box-shadow: 0 0 10px #000;
    }

    .roxo { background: linear-gradient(135deg, #5e2cff, #b98eff); }
    .rosa { background: linear-gradient(135deg, #ff4da6, #ff82d3); }

</style>
</head>
<body>

<h1>ðŸ“œ HistÃ³rico 7XX</h1>

<!-- Ãšltimo sinal -->
<div class="ultimo-sinal">
    <h2>ðŸ”¥ Ãšltimo Sinal</h2>
    <span id="ultimoValor">--</span>
    <span id="ultimoCor">--</span>
    <span id="ultimoHorario">--:--:--</span>
</div>

<!-- Filtros -->
<div class="filtros">
    <button class="ativo" data-cor="todas">Todas</button>
    <button data-cor="roxo">Roxo</button>
    <button data-cor="rosa">Rosa</button>
</div>

<!-- Lista -->
<div id="listaHistorico">Carregando...</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, query, orderBy, onSnapshot, doc } 
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBod8YVf5pKWI98m9rRR8axokDkNMlXX-k",
  authDomain: "aviatordaniel100x.firebaseapp.com",
  projectId: "aviatordaniel100x",
  storageBucket: "aviatordaniel100x.firebasestorage.app",
  messagingSenderId: "169015417803",
  appId: "1:169015417803:web:ce4aa4f9b77d5ddb07344e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// =======================
// ðŸ”¥ ÃšLTIMO SINAL
// =======================
function ouvirUltimo() {
    const ref = doc(db, "ultimo_sinal", "dados");

    onSnapshot(ref, snap => {
        if (!snap.exists()) return;

        const d = snap.data();
        document.getElementById("ultimoValor").textContent = `${d.valor}x`;
        document.getElementById("ultimoCor").textContent = d.cor;
        document.getElementById("ultimoHorario").textContent = d.hora;
    });
}

// =======================
// ðŸ”¥ HISTÃ“RICO
// =======================
let historicoCompleto = [];

function ouvirHistorico() {
    const q = query(
        collection(db, "historico_sinais"),
        orderBy("criado", "desc")
    );

    onSnapshot(q, snap => {
        historicoCompleto = [];
        snap.forEach(doc => historicoCompleto.push(doc.data()));
        atualizarHistorico("todas");
    });
}

// =======================
// ðŸ”¥ FILTROS
// =======================
document.querySelectorAll(".filtros button").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelector(".filtros .ativo").classList.remove("ativo");
        btn.classList.add("ativo");
        atualizarHistorico(btn.dataset.cor);
    });
});

// =======================
// ðŸ”¥ GERAR LISTA
// =======================
function atualizarHistorico(cor) {
    const lista = document.getElementById("listaHistorico");
    lista.innerHTML = "";

    let filtrado = historicoCompleto;

    if (cor !== "todas") {
        filtrado = historicoCompleto.filter(s => s.cor === cor);
    }

    filtrado.forEach(s => {
        const div = document.createElement("div");
        div.className = `hist-item ${s.cor}`;
        div.textContent = `${s.valor}x`;
        lista.appendChild(div);
    });

    if (filtrado.length === 0) {
        lista.innerHTML = "<p>Nenhum sinal encontrado.</p>";
    }
}

// =======================
// ðŸ”¥ INICIAR
// =======================
ouvirUltimo();
ouvirHistorico();

</script>

</body>
</html>
