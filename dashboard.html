<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - 7XX</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =============================
            DARK PREMIUM VISUAL (AJUSTADO)
        ============================= */
        :root {
            --cor-primaria: #ff4da6; /* Rosa */
            --cor-secundaria: #5e2cff; /* Roxo */
            --cor-terciaria: #00bcd4; /* Azul */
            --cor-gold: #ffd700; /* Ouro para 100x */
            --cor-verde: #00e676; /* Verde para prote√ß√£o */
            --cor-fundo-escuro: #0a0a0f;
            --cor-card-claro: #1d1d2a;
        }

        body {
            background: linear-gradient(135deg, var(--cor-fundo-escuro), #1a1030);
            color: #f1f1f1;
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            margin-bottom: 70px;
            margin: 0;
        }

        /* ===== √ÅREA DE JOGOS ===== */
        .game-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 230px);
        }
        iframe {
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ===== HIST√ìRICO VISUAL ===== */
        #listaHistorico {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 8px;
            padding: 10px;
            padding-bottom: 80px;
        }
        .hist-item {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 70px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1rem;
            color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: transform 0.2s;
            line-height: 1.1;
        }
        
        .azul { background: linear-gradient(145deg, #00b4db, #0083b0); }
        .roxo { background: linear-gradient(145deg, var(--cor-secundaria), #b98eff); }
        .rosa { background: linear-gradient(145deg, var(--cor-primaria), #ff82d3); }

        .hist-hora {
            font-size: 0.65rem;
            font-weight: normal;
            opacity: 0.9;
            margin-top: 2px;
        }

        .filtros {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            padding: 0 15px;
        }
        .filtros button {
            background: #14141f;
            color: #f1f1f1;
            border: 1px solid #2d2d3d;
            border-radius: 8px;
            padding: 6px 14px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        .filtros button.ativo {
            background: var(--cor-primaria);
            color: white;
            border-color: var(--cor-primaria);
        }

        /* ===== √öLTIMO SINAL CARD ===== */
        #ultimoSinalCard {
            padding: 15px;
            margin: 15px;
            border-radius: 12px;
            background: var(--cor-card-claro);
            box-shadow: 0 0 15px rgba(255, 77, 166, 0.2);
            text-align: center;
        }
        #ultimoSinalCard h2 {
            margin-top: 0;
            color: #ccc;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        #ultimoSinalCard .valor {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--cor-primaria);
            text-shadow: 0 0 10px rgba(255, 77, 166, 0.8);
        }

        /* ===== TIMER FLOAT (Bot√£o Flutuante) ===== */
        .timer-float {
            position: fixed;
            bottom: 90px; 
            right: 20px; 
            background: linear-gradient(135deg, #00c851, #007E33);
            color: white;
            border: 2px solid #fff;
            border-radius: 50px;
            padding: 10px 25px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0,200,81,0.6);
            z-index: 99;
            animation: pulse 2s infinite;
        }
        .timer-float span { display: block; font-size: 1.1rem; font-weight: 800; }
        .timer-float small { display: block; font-size: 0.75rem; opacity: 1; font-weight: 600; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 200, 81, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 200, 81, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 200, 81, 0); }
        }

        /* ===== MODAL (Visual 100x + Proje√ß√£o) ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        .modal-content {
            background: linear-gradient(160deg, #1a1a24, #252535);
            border: 2px solid var(--cor-primaria);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            max-width: 340px;
            width: 90%;
            box-shadow: 0 0 40px rgba(255,77,166,0.2);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Grid de Informa√ß√µes do Sinal */
        .sinal-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .sinal-box {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sinal-box.full { grid-column: span 2; background: rgba(255, 215, 0, 0.1); border-color: var(--cor-gold); }
        .sinal-label { font-size: 0.75rem; color: #aaa; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 4px;}
        .sinal-value { font-size: 1.2rem; font-weight: bold; color: #fff; }
        
        .destaque-verde { color: var(--cor-verde); }
        .destaque-gold { color: var(--cor-gold); font-size: 1.5rem; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

        /* Previs√µes 5 Rodadas */
        .projecao-container {
            display: flex;
            gap: 5px;
            justify-content: space-between;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .prev-box {
            background: #111;
            border-radius: 6px;
            padding: 8px 2px;
            flex: 1;
            text-align: center;
            border: 1px solid #333;
        }
        .prev-label { font-size: 0.65rem; color: #777; display: block; margin-bottom: 2px;}
        .prev-val { font-size: 0.85rem; font-weight: bold; }
        
        /* Cores das previs√µes */
        .p-azul { color: #00bcd4; border-color: #00bcd4; box-shadow: inset 0 0 5px rgba(0,188,212,0.2); }
        .p-roxo { color: #9b59b6; border-color: #9b59b6; box-shadow: inset 0 0 5px rgba(155,89,182,0.2); }
        .p-rosa { color: #ff4da6; border-color: #ff4da6; box-shadow: inset 0 0 5px rgba(255,77,166,0.2); }

        .btn-fechar {
            background: var(--cor-primaria);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            margin-top: 20px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            font-size: 1rem;
        }

        /* ===== SE√á√ïES E NAVBAR ===== */
        .secao { display: none; padding: 0; }
        .secao.ativa { display: block; }
        
        footer.navbar {
            position: fixed;
            bottom: 0; left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background: rgba(12, 12, 18, 0.98);
            padding: 12px 0;
            border-top: 2px solid var(--cor-primaria);
            z-index: 100;
        }
        .nav-item {
            text-align: center;
            color: #888;
            font-weight: 500;
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.3s;
            text-decoration: none;
        }
        .nav-item span { display: block; font-size: 0.7rem; opacity: 0.8; margin-top: 2px;}
        .nav-item.ativo-nav, .nav-item:hover { color: var(--cor-primaria); }
        .nav-item.ativo-jogo {
            color: #ffd95a;
            text-shadow: 0 0 8px rgba(255,217,90,0.5);
        }
    </style>
</head>
<body>

    <!-- √ÅREA DE JOGOS -->
    <section id="home" class="secao ativa">
        <!-- Card para √öltimo Sinal -->
        <div id="ultimoSinalCard">
            <h2>üî• √öltimo Sinal</h2>
            <div class="valor" id="ultimoValor">--</div>
            <span id="ultimoCor">--</span> | <span id="ultimoHorario">--:--</span>
        </div>
        
        <div class="game-container">
            <!-- Link do Jogo -->
            <iframe id="xxFrame" src="https://rn72q.com/game/action/3602?pid=575973404"></iframe>
        </div>
    </section>

    <!-- HIST√ìRICO -->
    <section id="historico" class="secao">
        <h2 style="text-align:center; margin-top:20px;">üìú Hist√≥rico Completo</h2>
        <div class="filtros">
            <button data-cor="todas" class="ativo">Todas</button>
            <button data-cor="roxo">Roxo</button>
            <button data-cor="rosa">Rosa</button>
        </div>
        <div id="listaHistorico">Carregando...</div>
    </section>

    <!-- PERFIL -->
    <section id="perfil" class="secao">
        <div style="padding:20px; text-align:center;">
            <h2>üë§ Meu Perfil</h2>
            <p id="userEmail" style="color:#aaa;">Usu√°rio logado...</p>
            <button class="btn-fechar" style="background:#333; margin-top:20px;" onclick="logout()">üö™ Sair</button>
        </div>
    </section>

    <!-- TIMER FLOAT (MODIFICADO) -->
    <button id="timerBtn" class="timer-float" onclick="abrirModalAnalise()">
        <span>‚ö° SINAL 100X</span>
        <small>VER PROJE√á√ÉO</small>
    </button>

    <!-- MODAL DE SINAL (MODIFICADO COM 5 VELAS) -->
    <div id="modalTimer" class="modal" onclick="if(event.target.id === 'modalTimer') toggleModal('modalTimer')">
        <div class="modal-content">
            <h2 style="color: #fff; margin: 0; font-size: 1.2rem;">üöÄ INTELIG√äNCIA ARTIFICIAL</h2>
            <p style="color: #888; font-size: 0.85rem; margin-top: 5px;">An√°lise em Tempo Real</p>
            
            <!-- Grid de Informa√ß√µes -->
            <div class="sinal-grid">
                <!-- Hor√°rio -->
                <div class="sinal-box full">
                    <span class="sinal-label">‚è±Ô∏è Entrada Sugerida</span>
                    <span class="sinal-value" id="horarioEntrada">--:--</span>
                </div>

                <!-- Prote√ß√£o -->
                <div class="sinal-box">
                    <span class="sinal-label">üõ°Ô∏è Prote√ß√£o</span>
                    <span class="sinal-value destaque-verde">2.00x</span>
                </div>

                <!-- Entrada (Fixa) -->
                <div class="sinal-box">
                    <span class="sinal-label">üîÑ Padr√£o</span>
                    <span class="sinal-value">Gale 2</span>
                </div>

                <!-- Alvo Principal -->
                <div class="sinal-box full" style="background: rgba(255, 77, 166, 0.1); border-color: var(--cor-primaria);">
                    <span class="sinal-label">üéØ ALVO M√ÅXIMO 100X</span>
                    <span class="sinal-value destaque-gold">Buscar Vela Rosa</span>
                </div>
            </div>

            <!-- Proje√ß√£o Pr√≥ximas 5 -->
            <div style="margin-top:20px; text-align:left;">
                <span style="font-size:0.8rem; color:#aaa; text-transform:uppercase; letter-spacing:1px;">üîÆ Proje√ß√£o Pr√≥ximas 5 Rodadas:</span>
                <div class="projecao-container" id="projecaoContainer">
                    <div class="prev-box"><span class="prev-label">1¬™</span><div class="prev-val">--</div></div>
                    <div class="prev-box"><span class="prev-label">2¬™</span><div class="prev-val">--</div></div>
                    <div class="prev-box"><span class="prev-label">3¬™</span><div class="prev-val">--</div></div>
                    <div class="prev-box"><span class="prev-label">4¬™</span><div class="prev-val">--</div></div>
                    <div class="prev-box"><span class="prev-label">5¬™</span><div class="prev-val">--</div></div>
                </div>
            </div>
            
            <div class="alerta aviso" style="margin-top: 15px; font-size: 0.75rem; color: #666;">
                ‚ö†Ô∏è Baseado no padr√£o atual da cole√ß√£o 'historico_sinais'.
            </div>
            
            <button class="btn-fechar" onclick="toggleModal('modalTimer')">ENTENDIDO</button>
        </div>
    </div>

    <!-- NAVBAR -->
    <footer class="navbar">
        <div class="nav-item ativo-jogo" id="btn7xx" data-secao="home" onclick="mudarSecao(this, 'home')">‚úàÔ∏è <span>Jogo</span></div>
        <div class="nav-item" data-secao="historico" onclick="mudarSecao(this, 'historico')">üìú <span>Hist√≥rico</span></div>
        <a href="https://t.me/aviatorvip100x" target="_blank" class="nav-item">üì¢ <span>Telegram</span></a>
        <div class="nav-item" data-secao="perfil" onclick="mudarSecao(this, 'perfil')">üë§ <span>Perfil</span></div>
    </footer>

    <!-- C√ìDIGO JAVASCRIPT/FIREBASE -->
    <script type="module">

    /* ===== IMPORTS E INICIALIZA√á√ÉO DO FIREBASE ===== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, doc, setLogLevel } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBod8YVf5pKWI98m9rRR8axokDkNMlXX-k",
        authDomain: "aviatordaniel100x.firebaseapp.com",
        databaseURL: "https://aviatordaniel100x-default-rtdb.firebaseio.com",
        projectId: "aviatordaniel100x",
        storageBucket: "aviatordaniel100x.firebasestorage.app",
        messagingSenderId: "169015417803",
        appId: "1:169015417803:web:ce4aa4f9b77d5ddb07344e",
        measurementId: "G-EES9SVSV72"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    setLogLevel('silent'); 

    // Login An√¥nimo
    onAuthStateChanged(auth, (user) => {
        if (!user) {
            signInAnonymously(auth).catch(console.error);
        }
    });

    window.addEventListener("DOMContentLoaded", () => {
        
        /* === NAVEGA√á√ÉO === */
        const secoes = {
            home: document.getElementById("home"),
            historico: document.getElementById("historico"),
            perfil: document.getElementById("perfil")
        };
        const navItems = document.querySelectorAll(".nav-item");
        const listaHistorico = document.getElementById("listaHistorico");

        let historicoCompleto = [];
        let filtroCorAtual = 'todas';

        window.mudarSecao = (btn, idSecao) => {
            Object.values(secoes).forEach(sec => sec.classList.remove("ativa"));
            secoes[idSecao].classList.add("ativa");
            navItems.forEach(item => {
                item.classList.remove("ativo-jogo");
                item.classList.remove("ativo-nav");
            });
            if (idSecao === 'home') {
                document.getElementById('btn7xx').classList.add('ativo-jogo');
            } else if (btn && btn.tagName === 'DIV') {
                 btn.classList.add("ativo-nav");
            }
        };

        window.toggleModal = (id) => {
            const modal = document.getElementById(id);
            modal.style.display = modal.style.display === "flex" ? "none" : "flex";
        };

        /* === L√ìGICA DE HOR√ÅRIO PARA ENTRADA === */
        function formatarZero(num) { return num < 10 ? `0${num}` : num; }

        function calcularJanelaEntrada() {
            const agora = new Date();
            agora.setMinutes(agora.getMinutes() + 1); // +1 min pra frente
            const hora = agora.getHours();
            const minAlvo = agora.getMinutes();

            // 1 min antes
            let minAntes = minAlvo - 1;
            let horaAntes = hora;
            if(minAntes < 0) { minAntes = 59; horaAntes--; if(horaAntes < 0) horaAntes = 23; }

            // 1 min depois
            let minDepois = minAlvo + 1;
            let horaDepois = hora;
            if(minDepois > 59) { minDepois = 0; horaDepois++; if(horaDepois > 23) horaDepois = 0; }

            return `${formatarZero(horaAntes)}:${formatarZero(minAntes)} at√© ${formatarZero(horaDepois)}:${formatarZero(minDepois)}`;
        }

        /* === ALGORITMO DE PROJE√á√ÉO (5 RODADAS) === */
        function gerarProjecao5Rodadas(dadosHistoricos) {
            // Se tiver poucos dados, gera padr√£o fict√≠cio para n√£o quebrar
            if(!dadosHistoricos || dadosHistoricos.length < 5) {
                return [1.20, 2.50, 1.10, 3.00, 1.50];
            }

            const ultimos = dadosHistoricos.slice(0, 10).map(d => parseFloat(d.valor)); // Pega os 10 mais recentes
            const mediaRecente = ultimos.reduce((a,b)=>a+b,0) / ultimos.length;
            
            let previsoes = [];
            let base = mediaRecente > 2 ? mediaRecente * 0.8 : 1.50; // Ajuste base

            for(let i=0; i<5; i++) {
                // Fator de varia√ß√£o simples para simular volatilidade
                let variacao = (Math.random() * 2.5); 
                let projecao = base + (i % 2 === 0 ? -variacao/2 : variacao); // Alterna alto/baixo

                // Regra de "Quebra": Se a anterior foi muito alta, a pr√≥xima tende a ser baixa
                if(i > 0 && previsoes[i-1] > 5.00) projecao = 1.00 + Math.random();

                if (projecao < 1.00) projecao = 1.10;
                previsoes.push(projecao);
            }
            return previsoes;
        }

        /* === ABRIR MODAL COM DADOS E PROJE√á√ÉO === */
        window.abrirModalAnalise = () => {
            // 1. Janela de Tempo
            const janelaTempo = calcularJanelaEntrada();
            document.getElementById("horarioEntrada").innerText = janelaTempo;

            // 2. Calcular Proje√ß√£o das pr√≥ximas 5 baseada no Hist√≥rico Real
            const projecoes = gerarProjecao5Rodadas(historicoCompleto);
            const container = document.getElementById("projecaoContainer");
            container.innerHTML = ""; // Limpa anterior

            projecoes.forEach((val, idx) => {
                let classeCor = 'p-azul';
                if(val >= 10) classeCor = 'p-rosa';
                else if(val >= 2) classeCor = 'p-roxo';

                const html = `
                    <div class="prev-box ${classeCor}">
                        <span class="prev-label">${idx+1}¬™</span>
                        <div class="prev-val">${val.toFixed(2)}x</div>
                    </div>
                `;
                container.innerHTML += html;
            });

            // Abre o modal
            toggleModal('modalTimer');
        };

        /* === FIREBASE: √öLTIMO SINAL === */
        function ouvirUltimoSinal() {
            const ref = doc(db, "ultimo_sinal", "dados");
            onSnapshot(ref, snap => {
                if (!snap.exists()) return;
                const d = snap.data();
                const valorFormatado = parseFloat(d.valor).toFixed(2);
                
                document.getElementById("ultimoValor").textContent = `${valorFormatado}x`;
                document.getElementById("ultimoCor").textContent = d.cor === 'roxo' ? 'ROXO' : 'ROSA';
                document.getElementById("ultimoHorario").textContent = d.hora;
                document.getElementById("ultimoValor").style.color = d.cor === 'roxo' ? 'var(--cor-secundaria)' : 'var(--cor-primaria)';
            });
        }

        /* === FUN√á√ÉO AUXILIAR PARA FORMATAR HORA (FALLBACK) === */
        function getHoraFormatada(dataFirestore) {
            if (dataFirestore && dataFirestore.toDate) {
                const date = dataFirestore.toDate();
                return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            }
            return '--:--';
        }

        /* === FUN√á√ÉO PARA DETERMINAR A COR PELA VELOCIDADE (VALOR) === */
        function getClasseCor(valor) {
            if (valor >= 10.01) return 'rosa'; // Acima de 10.01x
            if (valor >= 2.00) return 'roxo';  // Entre 2.00x e 10.00x
            return 'azul';                     // At√© 1.99x
        }

        /* === FIREBASE: HIST√ìRICO (Cole√ß√£o: historico_sinais) === */
        function ouvirHistorico() {
            const q = query(collection(db, "historico_sinais"), orderBy("criado", "desc"));
            onSnapshot(q, snap => {
                historicoCompleto = [];
                snap.forEach(doc => {
                    const data = doc.data();
                    // Garante que valor seja num√©rico para c√°lculos
                    historicoCompleto.push({ ...data, valor: parseFloat(data.valor) });
                });
                renderizarHistorico(filtroCorAtual);
            });
        }

        function renderizarHistorico(corFiltro) {
            listaHistorico.innerHTML = "";
            let dados = historicoCompleto;
            if (corFiltro !== "todas") dados = historicoCompleto.filter(s => s.cor === corFiltro);

            if (dados.length === 0) {
                listaHistorico.innerHTML = `<p style="padding: 20px;">Vazio...</p>`;
                return;
            }

            const fragment = document.createDocumentFragment();
            dados.forEach(d => {
                const div = document.createElement("div");
                const valorFloat = d.valor; // J√° convertido no onSnapshot
                
                // Define cor baseada no valor num√©rico
                const classeCor = getClasseCor(valorFloat);
                
                // Define hora (usa d.hora se existir, sen√£o formata d.criado)
                const horaDisplay = d.hora ? d.hora : getHoraFormatada(d.criado);

                div.className = `hist-item ${classeCor}`;
                div.innerHTML = `
                    <span>${valorFloat.toFixed(2)}x</span>
                    <span class="hist-hora">${horaDisplay}</span>
                `;
                fragment.appendChild(div);
            });
            listaHistorico.appendChild(fragment);
        }
        
        document.querySelectorAll(".filtros button").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelector(".filtros .ativo").classList.remove("ativo");
                btn.classList.add("ativo");
                filtroCorAtual = btn.dataset.cor;
                renderizarHistorico(filtroCorAtual);
            });
        });

        /* === INICIALIZA√á√ÉO === */
        ouvirUltimoSinal();
        ouvirHistorico();

        onAuthStateChanged(auth, user => {
            if (user) document.getElementById("userEmail").textContent = `ID: ${user.uid.slice(0,6)}...`;
        });

        window.logout = async () => {
            await signOut(auth);
            location.reload();
        };

    });
    </script>
</body>
</html>
